<?phpinclude("includes/app_top.php");$pcat="Miscellaneous";$pagetitle="Statistics";$getid = getid('id');checkAdminLogin();checkState();?><?php include("includes/styles.php");?> <?php include("includes/colorbox.php");?><script language="javascript" type="text/javascript" src="flot/jquery.js"></script><script language="javascript" type="text/javascript" src="flot/jquery.flot.js"></script><script language="javascript" type="text/javascript" src="flot/jquery.flot.time.js"></script><script language="javascript" type="text/javascript" src="flot/jquery.flot.pie.js"></script><script language="javascript" type="text/javascript" src="flot/jquery.flot.stack.js"></script><script language="javascript" type="text/javascript" src="flot/jquery.flot.stackpercent.js"></script></head><body><?php include("includes/header.php");?><?php include("includes/side-bar.php");?><?php$vep=mysqli_fetch_assoc(mysqli_query($mysqli, "SELECT if(tablename like 'vep%',1,0) as vep from states where id=".$stateid));$options=mysqli_fetch_assoc(mysqli_query($mysqli, "SELECT * from categories where state_id=".$stateid));$startdate="20140310";if ($tablename=="call4varanasi" || $tablename=="call4amethivoter")    $startdate="20140415";$users1 = array();$query = "select unix_timestamp(date(datecreated))*1000 as date,count(*) as cnt from users where date(datecreated)>".$startdate." and state_id=$stateid group by date(datecreated)";$result = $mysqli->query($query) or die($mysqli->error.__LINE__);if($result->num_rows > 0) {    while($row = $result->fetch_assoc()) {        $users1[] = array( $row['date'], $row['cnt'] );    }}$users2 = array();$query = "select unix_timestamp(date)*1000 as date, count(*) as cnt from (select date(contactdate) as date,userid from ".$tablename." where date(contactdate)>".$startdate." group by date(contactdate),userid) A group by date;";$result = $mysqli->query($query) or die($mysqli->error.__LINE__);if($result->num_rows > 0) {    while($row = $result->fetch_assoc()) {        $users2[] = array( $row['date'], $row['cnt'] );    }}$calls1a = array();$calls1b = array();$calls1c = array();$calls1d = array();$query = "select unix_timestamp(date(contactdate))*1000 as date, iscalled, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled>0 group by date(contactdate),iscalled;";$result = $mysqli->query($query) or die($mysqli->error.__LINE__);if($result->num_rows > 0) {    while($row = $result->fetch_assoc()) {        if ($row['iscalled']==1)            $calls1a[] = array( $row['date'], $row['cnt'] );        if ($row['iscalled']==2)            $calls1b[] = array( $row['date'], $row['cnt'] );        if ($row['iscalled']==3)            $calls1c[] = array( $row['date'], $row['cnt'] );        if ($row['iscalled']==4)            $calls1d[] = array( $row['date'], $row['cnt'] );    }}$calls1A = array( "label" => "Call Completed", "color" => 3, "data" => $calls1a );$calls1B = array( "label" => "Wrong Number", "color" => 2, "data" => $calls1b );$calls1C = array( "label" => "Call Later", "color" => 1, "data" => $calls1c );$calls1D = array( "label" => "Not Reached", "color" => 0, "data" => $calls1d );$calls2 = array();$query = "select iscalled, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled>0 group by iscalled;";$result = $mysqli->query($query) or die($mysqli->error.__LINE__);if($result->num_rows > 0) {    while($row = $result->fetch_assoc()) {        if ($row['iscalled']==1)            $calls2[] = array( "label" => "Call Completed", "color" => 3, "data" => $row['cnt'] );        if ($row['iscalled']==2)            $calls2[] = array( "label" => "Wrong Number", "color" => 2, "data" => $row['cnt'] );        if ($row['iscalled']==3)            $calls2[] = array( "label" => "Call Later", "color" => 1, "data" => $row['cnt'] );        if ($row['iscalled']==4)            $calls2[] = array( "label" => "Not Reached", "color" => 0, "data" => $row['cnt'] );    }}if ($vep['vep']==0){    $votes1a = array();    $votes1b = array();    $votes1c = array();    $query = "select unix_timestamp(date(contactdate))*1000 as date, vote, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled=1 group by date(contactdate),vote;";    $result = $mysqli->query($query) or die($mysqli->error.__LINE__);    if($result->num_rows > 0) {        while($row = $result->fetch_assoc()) {            if ($row['vote']==0)                $votes1a[] = array( $row['date'], $row['cnt'] );            if ($row['vote']==1)                $votes1b[] = array( $row['date'], $row['cnt'] );            if ($row['vote']==2)                $votes1c[] = array( $row['date'], $row['cnt'] );        }    }    $votes1A = array( "label" => "No", "color" => 2, "data" => $votes1a );    $votes1B = array( "label" => "Yes", "color" => 3, "data" => $votes1b );    $votes1C = array( "label" => "Undecided", "color" => 0, "data" => $votes1c );    $votes2 = array();    $query = "select vote, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled=1 group by vote;";    $result = $mysqli->query($query) or die($mysqli->error.__LINE__);    if($result->num_rows > 0) {        while($row = $result->fetch_assoc()) {            if ($row['vote']==0)                $votes2[] = array( "label" => "No", "color" => 2, "data" => $row['cnt'] );            if ($row['vote']==1)                $votes2[] = array( "label" => "Yes", "color" => 3, "data" => $row['cnt'] );            if ($row['vote']==2)                $votes2[] = array( "label" => "Undecided", "color" => 0, "data" => $row['cnt'] );        }    }} else {    $votes1a = array();    $votes1b = array();    $votes1c = array();    $query = "select unix_timestamp(date(contactdate))*1000 as date, volunteer, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled=1 group by date(contactdate),volunteer;";    $result = $mysqli->query($query) or die($mysqli->error.__LINE__);    if($result->num_rows > 0) {        while($row = $result->fetch_assoc()) {            if ($row['volunteer']==0)                $votes1a[] = array( $row['date'], $row['cnt'] );            if ($row['volunteer']==1)                $votes1b[] = array( $row['date'], $row['cnt'] );            if ($row['volunteer']==2)                $votes1c[] = array( $row['date'], $row['cnt'] );        }    }    $votes1A = array( "label" => "Not Willing To Volunteer", "color" => 0, "data" => $votes1a );    $votes1B = array( "label" => "Willing To Volunteer", "color" => 3, "data" => $votes1b );    $votes1C = array( "label" => "Not AAP Supporter", "color" => 2, "data" => $votes1c );    $votes2 = array();    $query = "select volunteer, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled=1 group by volunteer;";    $result = $mysqli->query($query) or die($mysqli->error.__LINE__);    if($result->num_rows > 0) {        while($row = $result->fetch_assoc()) {            if ($row['volunteer']==0)                $votes2[] = array( "label" => "Not Willing To Volunteer", "color" => 0, "data" => $row['cnt'] );            if ($row['volunteer']==1)                $votes2[] = array( "label" => "Willing To Volunteer", "color" => 3, "data" => $row['cnt'] );            if ($row['volunteer']==2)                $votes2[] = array( "label" => "Not AAP Supporter", "color" => 2, "data" => $row['cnt'] );        }    }    $votes3 = array();    $query = "select volunteer, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled=1 and source like '%Volunteer%' group by volunteer;";    $result = $mysqli->query($query) or die($mysqli->error.__LINE__);    if($result->num_rows > 0) {        while($row = $result->fetch_assoc()) {            if ($row['volunteer']==0)                $votes3[] = array( "label" => "Not Willing To Volunteer", "color" => 0, "data" => $row['cnt'] );            if ($row['volunteer']==1)                $votes3[] = array( "label" => "Willing To Volunteer", "color" => 3, "data" => $row['cnt'] );            if ($row['volunteer']==2)                $votes3[] = array( "label" => "Not AAP Supporter", "color" => 2, "data" => $row['cnt'] );        }    }    $votes4 = array();    $query = "select volunteer, count(*) as cnt from ".$tablename." where date(contactdate)>".$startdate." and iscalled=1 and source like '%Member%' group by volunteer;";    $result = $mysqli->query($query) or die($mysqli->error.__LINE__);    if($result->num_rows > 0) {        while($row = $result->fetch_assoc()) {            if ($row['volunteer']==0)                $votes4[] = array( "label" => "Not Willing To Volunteer", "color" => 0, "data" => $row['cnt'] );            if ($row['volunteer']==1)                $votes4[] = array( "label" => "Willing To Volunteer", "color" => 3, "data" => $row['cnt'] );            if ($row['volunteer']==2)                $votes4[] = array( "label" => "Not AAP Supporter", "color" => 2, "data" => $row['cnt'] );        }    }}?> <div class="pageHeadingBlock ">        	<div class="grayBackground">                     	<h3 class="title">Reports</h3>            <div class="sectionTabNav">            	<?php echo $tab_website;?>            </div>        	</div>        </div>                <div class="clearfix sepH_b"></div><table width="100%" border="0" cellspacing="0" cellpadding="0">  <tr>    <td width="50%"><b>New User Registrations</b><br/><div id="users1" style="width:100%;height:300px;"></div></td>    <td width="50%"><b>Active Users</b><br/><div id="users2" style="width:100%;height:300px;"></div></td>  </tr>  <tr><td>&nbsp;</td><td></td></tr>  <tr>    <td width="50%"><b>Calls Made Over Time</b><br/><div id="calls1" style="width:100%;height:300px;"></div></td>    <td width="50%"><b>Calls Made Overall</b><br/><div id="calls2" style="width:100%;height:300px;"></div></td>  </tr>  <tr><td>&nbsp;</td><td></td></tr>  <tr>    <td width="50%"><b>Responses Over Time</b><br/><div id="votes1" style="width:100%;height:300px;"></div></td>    <td width="50%"><b>Responses Overall</b><br/><div id="votes2" style="width:100%;height:300px;"></div></td>  </tr>  <tr><td>&nbsp;</td><td></td></tr>  <tr <?php echo ($vep['vep']==0 ? 'style="display:none"' : '')?>>    <td width="50%"><b>Responses From Volunteer Data</b><br/><div id="votes3" style="width:100%;height:300px;"></div></td>    <td width="50%"><b>Responses From Member Data</b><br/><div id="votes4" style="width:100%;height:300px;"></div></td>  </tr></table><script id="source">$(function () {  function showTooltip(x, y, contents) {    $('<div id="tooltip">' + contents + '</div>').css( {    position: 'absolute',    display: 'none',    top: y + 20,    left: x - 20,    border: '1px solid #fdd',    padding: '2px',    'background-color': '#fee',    opacity: 0.80    }).appendTo("body").fadeIn(200);  }  var previousPoint = null;    function onPlotHover(event, pos, item) {     if (item) {        if (previousPoint != item.dataIndex) {            previousPoint = item.dataIndex;            $("#tooltip").remove();            var x = item.datapoint[0].toFixed(2),y = item.datapoint[1].toFixed(0);            var date = new Date(item.datapoint[0]);            var formattedTime = date.getDate()+' '+months[date.getMonth()]+' '+date.getFullYear();            showTooltip(item.pageX, item.pageY,formattedTime+" - "+y);        }     }  }    function labelFormatter(label, series) {    return "<div style='font-size:8pt; text-align:center; padding:2px; color:white;'>" + Math.round(series.percent) + "%<br/>(" + series.data[0][1] + ")</div>";  }    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];  var options = {  xaxis: { mode: "time", tickLength: 5, timeformat: "%b-%d", minTickSize: [1, "day"] },  series: { lines: { show: true}, points: {show: true} },  grid: { hoverable: true }  };    var options2 = {   series: { pie: { show: true,   label: { show: true, radius: 1/2, formatter: labelFormatter, background: { opacity: 0.5, color: "#000" } } }}  };    var d1 = <?php echo json_encode($users1); ?>;  var p1 = $.plot($("#users1"), [d1], options);  $("#users1").bind("plothover",onPlotHover);    var d2 = <?php echo json_encode($users2); ?>;  var p2 = $.plot($("#users2"), [d2], options);  $("#users2").bind("plothover",onPlotHover);  var d3a = <?php echo json_encode($calls1A); ?>;  var d3b = <?php echo json_encode($calls1B); ?>;  var d3c = <?php echo json_encode($calls1C); ?>;  var d3d = <?php echo json_encode($calls1D); ?>;  var p3 = $.plot($("#calls1"), [d3a,d3b,d3c,d3d], options);  $("#calls1").bind("plothover",onPlotHover);    var d4 = <?php echo preg_replace( "/\"(\d+)\"/", '$1', json_encode($calls2)); ?>;  var p4 = $.plot($("#calls2"), d4, options2);    var d5a = <?php echo json_encode($votes1A); ?>;  var d5b = <?php echo json_encode($votes1B); ?>;  var d5c = <?php echo json_encode($votes1C); ?>;  var p5 = $.plot($("#votes1"), [d5a,d5b,d5c], options);  $("#votes1").bind("plothover",onPlotHover);    var d6 = <?php echo preg_replace( "/\"(\d+)\"/", '$1', json_encode($votes2)); ?>;  var p6 = $.plot($("#votes2"), d6, options2);  <?php if ($vep['vep']) {?>      var d7 = <?php echo preg_replace( "/\"(\d+)\"/", '$1', json_encode($votes3)); ?>;      var p7 = $.plot($("#votes3"), d7, options2);      var d8 = <?php echo preg_replace( "/\"(\d+)\"/", '$1', json_encode($votes4)); ?>;      var p8 = $.plot($("#votes4"), d8, options2);  <?php } ?>});</script><?php include("includes/footer.php");?></body></html>